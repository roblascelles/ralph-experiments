services:
  ralph-agent:
    build: .
    container_name: ralph_sandbox
    # Ensure we can use interactive features like tmux and gh auth
    stdin_open: true 
    tty: true
    volumes:
      # Mount your current project folder into the sandbox
      - ../workspace:/home/ralph/workspace
      # Mount Docker socket for Docker-from-Docker
      - /var/run/docker.sock:/var/run/docker.sock
      - ./ralph.sh:/home/ralph/ralph.sh:ro  # Mount single file as read-only
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G      
    environment:
      - PYTHONUNBUFFERED=1
      - GH_TOKEN=${GH_TOKEN}
    # This keeps the container alive so you can exec into it
    command: /bin/bash -c "tmux new-session -s ralph_loop 'echo Ralph Sandbox Ready!; /bin/bash'"